from flask import Flask, render_template, request, jsonify
import sklearn
import numpy as np
import joblib


app = Flask(__name__)

@app.route('/')
def main():
    return render_template('main.html')

@app.route('/index', methods=['GET', 'POST'])
def index():
    global prediction_result  # Indicate that prediction_result is a global variable
    global form_values
    global unit
    unit=None
    prediction_result = None
    form_values={}

    if request.method == 'POST':
        state = request.form['state']
        district = request.form['district']
        crop = request.form['crop']
        year = request.form['year']
        season = request.form['season']
        area = request.form['area']
        hec=float(area)

        state_dict = {'Andaman and Nicobar Islands': 0, 'Andhra Pradesh': 1, 'Arunachal Pradesh': 2, 'Assam': 3, 'Bihar': 4, 'Chandigarh': 5, 'Chhattisgarh': 6, 'Dadra and Nagar Haveli': 7, 'Daman And Diu': 8, 'Delhi': 9, 'Goa': 10, 'Gujarat': 11, 'Haryana': 12, 'Himachal Pradesh': 13, 'Jammu And Kashmir': 14, 'Jharkhand': 15, 'Karnataka': 16, 'Kerala': 17, 'Laddakh': 18, 'Madhya Pradesh': 19, 'Maharashtra': 20, 'Manipur': 21, 'Meghalaya': 22, 'Mizoram': 23, 'Nagaland': 24, 'Odisha': 25, 'Puducherry': 26, 'Punjab': 27, 'Rajasthan': 28, 'Sikkim': 29, 'Tamil Nadu': 30, 'Telangana': 31, 'Tripura': 32, 'Uttar Pradesh': 33, 'Uttarakhand': 34, 'West Bengal': 35}
        district_dict = {'24 Paraganas North': 0, '24 Paraganas South': 1, 'Adilabad': 2, 'Agar Malwa': 3, 'Agra': 4, 'Ahmadabad': 5, 'Ahmednagar': 6, 'Aizawl': 7, 'Ajmer': 8, 'Akola': 9, 'Alappuzha': 10, 'Aligarh': 11, 'Alipurduar': 12, 'Alirajpur': 13, 'Allahabad': 14, 'Almora': 15, 'Alwar': 16, 'Ambala': 17, 'Ambedkar Nagar': 18, 'Amethi': 19, 'Amravati': 20, 'Amreli': 21, 'Amritsar': 22, 'Amroha': 23, 'Anand': 24, 'Anantapur': 25, 'Anantnag': 26, 'Anjaw': 27, 'Anugul': 28, 'Anuppur': 29, 'Araria': 30, 'Aravalli': 31, 'Ariyalur': 32, 'Arwal': 33, 'Ashoknagar': 34, 'Auraiya': 35, 'Aurangabad': 36, 'Azamgarh': 37, 'Andaman And Nicobar Islands': 38, 'Badgam': 39, 'Bagalkot': 40, 'Bagalkote': 41, 'Bageshwar': 42, 'Baghpat': 43, 'Bahraich': 44, 'Baksa': 45, 'Balaghat': 46, 'Balangir': 47, 'Baleshwar': 48, 'Ballari': 49, 'Ballia': 50, 'Balod': 51, 'Baloda Bazar': 52, 'Balrampur': 53, 'Banas Kantha': 54, 'Banda': 55, 'Bandipora': 56, 'Bangalore Rural': 57, 'Banka': 58, 'Bankura': 59, 'Banswara': 60, 'Barabanki': 61, 'Baramulla': 62, 'Baran': 63, 'Bareilly': 64, 'Bargarh': 65, 'Barmer': 66, 'Barnala': 67, 'Barpeta': 68, 'Barwani': 69, 'Bastar': 70, 'Basti': 71, 'Bathinda': 72, 'Beed': 73, 'Begusarai': 74, 'Belagavi': 75, 'Belgaum': 76, 'Bellary': 77, 'Bemetara': 78, 'Bengaluru Urban': 79, 'Betul': 80, 'Bhadradri': 81, 'Bhadrak': 82, 'Bhagalpur': 83, 'Bhandara': 84, 'Bharatpur': 85, 'Bharuch': 86, 'Bhavnagar': 87, 'Bhilwara': 88, 'Bhind': 89, 'Bhiwani': 90, 'Bhojpur': 91, 'Bhopal': 92, 'Bidar': 93, 'Bijapur': 94, 'Bijnor': 95, 'Bikaner': 96, 'Bilaspur': 97, 'Birbhum': 98, 'Bishnupur': 99, 'Biswanath': 100, 'Bokaro': 101, 'Bongaigaon': 102, 'Botad': 103, 'Boudh': 104, 'Budaun': 105, 'Bulandshahr': 106, 'Buldhana': 107, 'Bundi': 108, 'Burhanpur': 109, 'Buxar': 110, 'Cachar': 111, 'Chamarajanagar': 112, 'Chamarajanagara': 113, 'Chamba': 114, 'Chamoli': 115, 'Champawat': 116, 'Champhai': 117, 'Chandauli': 118, 'Chandel': 119, 'Chandigarh': 120, 'Chandrapur': 121, 'Changlang': 122, 'Charaideo': 123, 'Charki Dadri': 124, 'Chatra': 125, 'Chengalpattu': 126, 'Chennai': 127, 'Chhatarpur': 128, 'Chhindwara': 129, 'Chhotaudepur': 130, 'Chikballapur': 131, 'Chikkaballapura': 132, 'Chikkamagaluru': 133, 'Chikmagalur': 134, 'Chirang': 135, 'Chitradurga': 136, 'Chitrakoot': 137, 'Chittoor': 138, 'Chittorgarh': 139, 'Churachandpur': 140, 'Churu': 141, 'Coimbatore': 142, 'Coochbehar': 143, 'Cuddalore': 144, 'Cuttack': 145, 'Dadra And Nagar Haveli': 146, 'Dakshin Kannad': 147, 'Dakshina Kannada': 148, 'Daman': 149, 'Damoh': 150, 'Dang': 151, 'Dantewada': 152, 'Darbhanga': 153, 'Darjeeling': 154, 'Darrang': 155, 'Datia': 156, 'Dausa': 157, 'Davangere': 158, 'Dehradun': 159, 'Delhi_Total': 160, 'Deogarh': 161, 'Deoghar': 162, 'Deoria': 163, 'Devbhumi Dwarka': 164, 'Dewas': 165, 'Dhalai': 166, 'Dhamtari': 167, 'Dhanbad': 168, 'Dhar': 169, 'Dharmapuri': 170, 'Dharwad': 171, 'Dhemaji': 172, 'Dhenkanal': 173, 'Dholpur': 174, 'Dhubri': 175, 'Dhule': 176, 'Dibang Valley': 177, 'Dibrugarh': 178, 'Dima Hasao': 179, 'Dimapur': 180, 'Dinajpur Dakshin': 181, 'Dinajpur Uttar': 182, 'Dindigul': 183, 'Dindori': 184, 'Diu': 185, 'Doda': 186, 'Dohad': 187, 'Dumka': 188, 'Dungarpur': 189, 'Durg': 190, 'Daman And Diu': 191, 'Delhi': 192, 'East District': 193, 'East Garo Hills': 194, 'East Godavari': 195, 'East Jaintia Hills': 196, 'East Kameng': 197, 'East Khasi Hills': 198, 'East Siang': 199, 'East Singhbum': 200, 'Ernakulam': 201, 'Erode': 202, 'Etah': 203, 'Etawah': 204, 'Faizabad': 205, 'Faridabad': 206, 'Faridkot': 207, 'Farrukhabad': 208, 'Fatehabad': 209, 'Fatehgarh Sahib': 210, 'Fatehpur': 211, 'Fazilka': 212, 'Firozabad': 213, 'Firozepur': 214, 'Gadag': 215, 'Gadchiroli': 216, 'Gajapati': 217, 'Ganderbal': 218, 'Gandhinagar': 219, 'Ganganagar': 220, 'Ganjam': 221, 'Garhwa': 222, 'Gariyaband': 223, 'Gaurella-Pendra-Marwahi': 224, 'Gautam Buddha Nagar': 225, 'Gaya': 226, 'Ghaziabad': 227, 'Ghazipur': 228, 'Gir Somnath': 229, 'Giridih': 230, 'Goalpara': 231, 'Godda': 232, 'Golaghat': 233, 'Gomati': 234, 'Gonda': 235, 'Gondia': 236, 'Gopalganj': 237, 'Gorakhpur': 238, 'Gulbarga': 239, 'Gumla': 240, 'Guna': 241, 'Guntur': 242, 'Gurdaspur': 243, 'Gurgaon': 244, 'Gwalior': 245, 'Goa': 246, 'Hailakandi': 247, 'Hamirpur': 248, 'Hanumakonda': 249, 'Hanumangarh': 250, 'Hapur': 251, 'Harda': 252, 'Hardoi': 253, 'Haridwar': 254, 'Hassan': 255, 'Hathras': 256, 'Haveri': 257, 'Hazaribagh': 258, 'Hingoli': 259, 'Hisar': 260, 'Hojai': 261, 'Hooghly': 262, 'Hoshangabad': 263, 'Hoshiarpur': 264, 'Howrah': 265, 'Hyderabad': 266, 'Idukki': 267, 'Imphal East': 268, 'Imphal West': 269, 'Indore': 270, 'Jabalpur': 271, 'Jagatsinghapur': 272, 'Jagitial': 273, 'Jaipur': 274, 'Jaisalmer': 275, 'Jajapur': 276, 'Jalandhar': 277, 'Jalaun': 278, 'Jalgaon': 279, 'Jalna': 280, 'Jalore': 281, 'Jalpaiguri': 282, 'Jammu': 283, 'Jamnagar': 284, 'Jamtara': 285, 'Jamui': 286, 'Jangoan': 287, 'Janjgir-Champa': 288, 'Jashpur': 289, 'Jaunpur': 290, 'Jayashankar': 291, 'Jehanabad': 292, 'Jhabua': 293, 'Jhajjar': 294, 'Jhalawar': 295, 'Jhansi': 296, 'Jhargram': 297, 'Jharsuguda': 298, 'Jhunjhunu': 299, 'Jind': 300, 'Jodhpur': 301, 'Jogulamba': 302, 'Jorhat': 303, 'Junagadh': 304, 'Kabirdham': 305, 'Kachchh': 306, 'Kadapa': 307, 'Kaimur (Bhabua)': 308, 'Kaithal': 309, 'Kalaburagi': 310, 'Kalahandi': 311, 'Kalimpong': 312, 'Kallakurichi': 313, 'Kamareddy': 314, 'Kamle': 315, 'Kamrup': 316, 'Kamrup Metro': 317, 'Kanchipuram': 318, 'Kandhamal': 319, 'Kangra': 320, 'Kanker': 321, 'Kannauj': 322, 'Kanniyakumari': 323, 'Kannur': 324, 'Kanpur Dehat': 325, 'Kanpur Nagar': 326, 'Kapurthala': 327, 'Karaikal': 328, 'Karauli': 329, 'Karbi Anglong': 330, 'Kargil': 331, 'Karimganj': 332, 'Karimnagar': 333, 'Karnal': 334, 'Karur': 335, 'Kasaragod': 336, 'Kasganj': 337, 'Kathua': 338, 'Katihar': 339, 'Katni': 340, 'Kaushambi': 341, 'Kendrapara': 342, 'Kendujhar': 343, 'Khagaria': 344, 'Khammam': 345, 'Khandwa': 346, 'Khargone': 347, 'Kheda': 348, 'Kheri': 349, 'Khordha': 350, 'Khowai': 351, 'Khunti': 352, 'Kinnaur': 353, 'Kiphire': 354, 'Kishanganj': 355, 'Kishtwar': 356, 'Kodagu': 357, 'Koderma': 358, 'Kohima': 359, 'Kokrajhar': 360, 'Kolar': 361, 'Kolasib': 362, 'Kolhapur': 363, 'Kollam': 364, 'Komaram Bheem Asifabad': 365, 'Kondagaon': 366, 'Koppal': 367, 'Koraput': 368, 'Korba': 369, 'Korea': 370, 'Kota': 371, 'Kottayam': 372, 'Kozhikode': 373, 'Kra Daadi': 374, 'Krishna': 375, 'Krishnagiri': 376, 'Kulgam': 377, 'Kullu': 378, 'Kupwara': 379, 'Kurnool': 380, 'Kurukshetra': 381, 'Kurung Kumey': 382, 'Kushi Nagar': 383, 'Lahul And Spiti': 384, 'Lakhimpur': 385, 'Lakhisarai': 386, 'Lalitpur': 387, 'Latehar': 388, 'Latur': 389, 'Lawngtlai': 390, 'Leh Ladakh': 391, 'Leparada': 392, 'Lohardaga': 393, 'Lohit': 394, 'Longding': 395, 'Longleng': 396, 'Lower Dibang Valley': 397, 'Lower Siang': 398, 'Lower Subansiri': 399, 'Lucknow': 400, 'Ludhiana': 401, 'Lunglei': 402, 'Madhepura': 403, 'Madhubani': 404, 'Madurai': 405, 'Mahabubabad': 406, 'Maharajganj': 407, 'Mahasamund': 408, 'Mahbubnagar': 409, 'Mahe': 410, 'Mahendragarh': 411, 'Mahesana': 412, 'Mahisagar': 413, 'Mahoba': 414, 'Mainpuri': 415, 'Majuli': 416, 'Malappuram': 417, 'Maldah': 418, 'Malkangiri': 419, 'Mamit': 420, 'Mancherial': 421, 'Mandi': 422, 'Mandla': 423, 'Mandsaur': 424, 'Mandya': 425, 'Mansa': 426, 'Marigaon': 427, 'Mathura': 428, 'Mau': 429, 'Mayurbhanj': 430, 'Medak': 431, 'Medchal': 432, 'Medchal Malkajgiri': 433, 'Medinipur East': 434, 'Medinipur West': 435, 'Meerut': 436, 'Mewat': 437, 'Mirzapur': 438, 'Moga': 439, 'Mokokchung': 440, 'Mon': 441, 'Moradabad': 442, 'Morbi': 443, 'Morena': 444, 'Muktsar': 445, 'Mulugu': 446, 'Mumbai': 447, 'Mumbai Suburban': 448, 'Mungeli': 449, 'Munger': 450, 'Murshidabad': 451, 'Muzaffarnagar': 452, 'Muzaffarpur': 453, 'Mysore': 454, 'Mysuru': 455, 'Nabarangpur': 456, 'Nadia': 457, 'Nagaon': 458, 'Nagapattinam': 459, 'Nagarkurnool': 460, 'Nagaur': 461, 'Nagpur': 462, 'Nainital': 463, 'Nalanda': 464, 'Nalbari': 465, 'Nalgonda': 466, 'Namakkal': 467, 'Namsai': 468, 'Nanded': 469, 'Nandurbar': 470, 'Narayanapet': 471, 'Narayanpur': 472, 'Narmada': 473, 'Narsinghpur': 474, 'Nashik': 475, 'Navsari': 476, 'Nawada': 477, 'Nawanshahr': 478, 'Nayagarh': 479, 'Neemuch': 480, 'Nicobars': 481, 'Nirmal': 482, 'Niwari': 483, 'Nizamabad': 484, 'North And Middle Andaman': 485, 'North District': 486, 'North Garo Hills': 487, 'North Goa': 488, 'North Tripura': 489, 'Nuapada': 490, 'Osmanabad': 491, 'Pakke Kessang': 492, 'Pakur': 493, 'Palakkad': 494, 'Palamu': 495, 'Palghar': 496, 'Pali': 497, 'Palwal': 498, 'Panch Mahals': 499, 'Panchkula': 500, 'Panipat': 501, 'Panna': 502, 'Papum Pare': 503, 'Parbhani': 504, 'Paschim Bardhaman': 505, 'Pashchim Champaran': 506, 'Patan': 507, 'Pathanamthitta': 508, 'Pathankot': 509, 'Patiala': 510, 'Patna': 511, 'Pauri Garhwal': 512, 'Peddapalli': 513, 'Perambalur': 514, 'Peren': 515, 'Phek': 516, 'Pilibhit': 517, 'Pithoragarh': 518, 'Pondicherry': 519, 'Poonch': 520, 'Porbandar': 521, 'Prakasam': 522, 'Pratapgarh': 523, 'Pudukkottai': 524, 'Pulwama': 525, 'Pune': 526, 'Purba Bardhaman': 527, 'Purbi Champaran': 528, 'Puri': 529, 'Purnia': 530, 'Purulia': 531, 'Rae Bareli': 532, 'Raichur': 533, 'Raigad': 534, 'Raigarh': 535, 'Raipur': 536, 'Raisen': 537, 'Rajanna': 538, 'Rajauri': 539, 'Rajgarh': 540, 'Rajkot': 541, 'Rajnandgaon': 542, 'Rajsamand': 543, 'Ramanagara': 544, 'Ramanathapuram': 545, 'Ramban': 546, 'Ramgarh': 547, 'Rampur': 548, 'Ranchi': 549, 'Rangareddi': 550, 'Ranipet': 551, 'Ratlam': 552, 'Ratnagiri': 553, 'Rayagada': 554, 'Reasi': 555, 'Rewa': 556, 'Rewari': 557, 'Ri Bhoi': 558, 'Rohtak': 559, 'Rohtas': 560, 'Rudra Prayag': 561, 'Rupnagar': 562, 'S': 563, 'Sabar Kantha': 564, 'Sagar': 565, 'Saharanpur': 566, 'Saharsa': 567, 'Sahebganj': 568, 'Saiha': 569, 'Salem': 570, 'Samastipur': 571, 'Samba': 572, 'Sambalpur': 573, 'Sambhal': 574, 'Sangareddy': 575, 'Sangli': 576, 'Sangrur': 577, 'Sant Kabeer Nagar': 578, 'Sant Ravidas Nagar': 579, 'Saraikela Kharsawan': 580, 'Saran': 581, 'Satara': 582, 'Satna': 583, 'Sawai Madhopur': 584, 'Sehore': 585, 'Senapati': 586, 'Seoni': 587, 'Sepahijala': 588, 'Serchhip': 589, 'Shahdol': 590, 'Shahid Bhagat Singh Nagar': 591, 'Shahjahanpur': 592, 'Shajapur': 593, 'Shamli': 594, 'Sheikhpura': 595, 'Sheohar': 596, 'Sheopur': 597, 'Shi Yomi': 598, 'Shimla': 599, 'Shimoga': 600, 'Shivamogga': 601, 'Shivpuri': 602, 'Shopian': 603, 'Shravasti': 604, 'Siang': 605, 'Siddharth Nagar': 606, 'Siddipet': 607, 'Sidhi': 608, 'Sikar': 609, 'Simdega': 610, 'Sindhudurg': 611, 'Singrauli': 612, 'Sirmaur': 613, 'Sirohi': 614, 'Sirsa': 615, 'Sitamarhi': 616, 'Sitapur': 617, 'Sivaganga': 618, 'Sivasagar': 619, 'Siwan': 620, 'Solan': 621, 'Solapur': 622, 'Sonbhadra': 623, 'Sonepur': 624, 'Sonipat': 625, 'Sonitpur': 626, 'South Andamans': 627, 'South District': 628, 'South Garo Hills': 629, 'South Goa': 630, 'South Salmara Mancachar': 631, 'South Tripura': 632, 'South West Garo Hills': 633, 'South West Khasi Hills': 634, 'Spsr Nellore': 635, 'Srikakulam': 636, 'Srinagar': 637, 'Sukma': 638, 'Sultanpur': 639, 'Sundargarh': 640, 'Supaul': 641, 'Surajpur': 642, 'Surat': 643, 'Surendranagar': 644, 'Surguja': 645, 'Suryapet': 646, 'Tamenglong': 647, 'Tapi': 648, 'Tarn Taran': 649, 'Tawang': 650, 'Tehri Garhwal': 651, 'Tenkasi': 652, 'Thane': 653, 'Thanjavur': 654, 'The Nilgiris': 655, 'Theni': 656, 'Thiruvallur': 657, 'Thiruvananthapuram': 658, 'Thiruvarur': 659, 'Thoothukudi': 660, 'Thoubal': 661, 'Thrissur': 662, 'Tikamgarh': 663, 'Tinsukia': 664, 'Tirap': 665, 'Tiruchirappalli': 666, 'Tirunelveli': 667, 'Tirupathur': 668, 'Tiruppur': 669, 'Tiruvannamalai': 670, 'Tonk': 671, 'Tuensang': 672, 'Tumakuru': 673, 'Tumkur': 674, 'Tuticorin': 675, 'Udaipur': 676, 'Udalguri': 677, 'Udam Singh Nagar': 678, 'Udhampur': 679, 'Udupi': 680, 'Ujjain': 681, 'Ukhrul': 682, 'Umaria': 683, 'Una': 684, 'Unakoti': 685, 'Unnao': 686, 'Upper Siang': 687, 'Upper Subansiri': 688, 'Uttar Kannad': 689, 'Uttar Kashi': 690, 'Uttara Kannada': 691, 'Vadodara': 692, 'Vaishali': 693, 'Valsad': 694, 'Varanasi': 695, 'Vellore': 696, 'Vidisha': 697, 'Vijayapura': 698, 'Vikarabad': 699, 'Villupuram': 700, 'Virudhunagar': 701, 'Visakhapatanam': 702, 'Vizianagaram': 703, 'Wanaparthy': 704, 'Warangal': 705, 'Warangal Urban': 706, 'Wardha': 707, 'Washim': 708, 'Wayanad': 709, 'West District': 710, 'West Garo Hills': 711, 'West Godavari': 712, 'West Jaintia Hills': 713, 'West Kameng': 714, 'West Karbi Anglong': 715, 'West Khasi Hills': 716, 'West Siang': 717, 'West Singhbhum': 718, 'West Tripura': 719, 'Wokha': 720, 'Yadadri': 721, 'Yadagiri': 722, 'Yadgir': 723, 'Yamunanagar': 724, 'Yanam': 725, 'Yavatmal': 726, 'Zunheboto': 727}
        crop_dict = {'Arecanut': 0, 'Arhar/Tur': 1, 'Bajra': 2, 'Banana': 3, 'Barley': 4, 'Black Pepper': 5, 'Cardamom': 6, 'Cashewnut': 7, 'Castor Seed': 8, 'Coconut': 9, 'Coriander': 10, 'Cotton(Lint)': 11, 'Cowpea(Lobia)': 12, 'Dry Ginger': 13, 'Dry Chillies': 14, 'Garlic': 15, 'Ginger': 16, 'Gram': 17, 'Groundnut': 18, 'Guar Seed': 19, 'Horse-Gram': 20, 'Jowar': 21, 'Jute': 22, 'Khesari': 23, 'Linseed': 24, 'Maize': 25, 'Masoor': 26, 'Mesta': 27, 'Moong(Green Gram)': 28, 'Moth': 29, 'Niger Seed': 30, 'Oilseeds Total': 31, 'Onion': 32, 'Other Cereals': 33, 'Other Kharif Pulses': 34, 'Other Rabi Pulses': 35, 'Other Summer Pulses': 36, 'Peas & Beans (Pulses)': 37, 'Potato': 38, 'Ragi': 39, 'Rapeseed &Mustard': 40, 'Rice': 41, 'Safflower': 42, 'Sannhamp': 43, 'Sesamum': 44, 'Small Millets': 45, 'Soyabean': 46, 'Sugarcane': 47, 'Sunflower': 48, 'Sweet Potato': 49, 'Tapioca': 50, 'Tobacco': 51, 'Turmeric': 52, 'Urad': 53, 'Wheat': 54, 'Other Oilseeds': 55}
        season_dict = {'Autumn': 0, 'Kharif': 1, 'Rabi': 2, 'Summer': 3, 'Whole Year': 4, 'Winter': 5}


        state_unique_value = state_dict.get(state)
        district_unique_value = district_dict.get(district)
        crop_unique_value = crop_dict.get(crop)
        season_unique_value = season_dict.get(season)

        model = joblib.load('F:\\agropred\\AgroPred\\smartinternz\\ML\\random_forest_model.joblib')
        array = [state_unique_value, district_unique_value, crop_unique_value, season_unique_value, hec]
        final_features = [np.array(array)]
        prediction = model.predict(final_features)
        ans = float(prediction[0])

        prediction_result = ans
        if(crop=='Cotton' or crop=='Mesta' or crop=='Jute'):
            unit='bales'
            prediction_result=int(prediction_result)
        elif(crop=='Coconut'):
            unit='nuts'
            prediction_result=int(prediction_result)
        else:
            unit='tonnes'
            prediction_result=round(prediction_result,2)

        form_values = {
            'state': state,
            'district': district,
            'crop': crop,
            'year': year,
            'season': season,
            'area': area
        }
    
    return render_template('index.html', prediction_result=prediction_result,unit=unit, **form_values)



if __name__ == '__main__':
    app.run(debug=True)
